---
title: "Multiview embedding vs Time series vs. Regression predicting weather in Fresno"
author: "Luke Beebe"
output: html_notebook
---
```{r setup, include=TRUE, echo=TRUE}
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(lars)
```

NEED TO TAKE OUT FIRST SEASON (only two months) AND LAST SEASON (only one)


We will first load the data collected from multiple sources of the major weather predictors for Fresno.
MEI
PDO
IOD
AO1
PDO1
sunspot
PRCP
TAVG

```{r data1}
weather_data <- read.csv("/Users/lukebeebe/Documents/School/Rutgers/2024 Spring/Independent Study/HF_data.csv")
fresno <- weather_data[,-c(1,4,5,12,15)] # remove unnecessary columns
head(fresno)
```

We will build a new dataset with the mean averages of each variable for each season of each year.

March, April, May are assigned 1 (Spring)
June, July, August are assigned 2 (Summer)
September, October, November are assigned 3 (Fall)
December, January, February are assigned 4 (Winter)

We will also round up the average year as not to confuse the winter season with the previous year. (December 1963 will be included with Winter 1964)

```{r data2}
season <- c(4,4,1,1,1,2,2,2,3,3,3,4)
fresno <- cbind(season, fresno)
fresno_season <- (fresno[1,]+fresno[2,])/2 # first winter
fresno <- fresno[-c(1,2),]
for(m in 1:floor(length(fresno$year)/3)){
  season <- (fresno[1,]+fresno[2,]+fresno[3,])/3
  fresno_season <- rbind(fresno_season, season)
  fresno <- fresno[-c(1,2,3),]
}
fresno_season$year <- as.integer(ceiling(fresno_season$year))
fresno_season <- fresno_season[,-c(3)]
fresno_season <- fresno_season[-c(1, nrow(fresno_season)),] # remove first winter and last winter (incomplete data)
head(fresno_season)
```

Let's see what the data looks like.

```{r data3}
ggplot(fresno_season, aes(x=year, y=F_TAVG)) + geom_line() +
  geom_smooth(linewidth=1, method='lm',se=F) + facet_wrap(~season, scales="free_y")
```

There seems to be no real general trend. Spring seems to bring the most rainfall. Let's look at the densities of these functions.

```{r data4}
stats <- stat <- NULL
for(season in 1:4){
  mu <- mean(fresno_season[fresno_season$season==season,]$F_TAVG)
  med <- median(fresno_season[fresno_season$season==season,]$F_TAVG)
  lr <- median(fresno_season[fresno_season$season==season & fresno_season$F_TAVG<med,]$F_TAVG)
  ur <- median(fresno_season[fresno_season$season==season & fresno_season$F_TAVG>med,]$F_TAVG)
  sd <- sqrt(var(fresno_season[fresno_season$season==season,]$F_TAVG))
  stat <- cbind(season, med, lr, ur, mu, sd, lb=mu-sd, ub=mu+sd)
  stats <- rbind(stats, stat)
}
stats <- as.data.frame(stats)
ggplot(fresno_season, aes(x=F_TAVG)) + geom_density(color="darkblue",fill="lightblue") +
  geom_vline(data=stats, aes(xintercept=med), color="red", linetype="dashed") + 
  geom_vline(data=stats, aes(xintercept=lr), color="grey", linetype="dashed") +
  geom_vline(data=stats, aes(xintercept=ur), color="grey", linetype="dashed") +
  facet_wrap(~season, scales="free")
```
Using IQR for prediction accuracy as not every density is normal.

For season 2 (Summer). It is dry, 0 is the lower range. If there is a wet summer, does the model predict for something that is more of an 'outlier' to the historical data? If it were to predict near 0 each year it would be 'successful' in accuracy, but would be near useless if the historical data already does this for us.

```{r code}
stats

```



